<!doctype html>
<html lang="ca">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>La casa del terror</title>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#220000,#110000);
  color:#fff;
  text-align:center;
  padding:40px;
}
h1{
  font-family: Arial, Helvetica, sans-serif;
  font-size: 34px;
  letter-spacing: 3px;
  font-weight: 900;
  margin-bottom: 10px;
  text-transform: uppercase;
  text-shadow: 2px 2px 0 #000, 4px 4px 0 #000;
}
@media (max-width: 480px){
  body{ padding:20px; }
  h1{ font-size: 28px; letter-spacing: 2px; }
}

.card{
  max-width:720px;
  margin:auto;
  padding:32px;
  border-radius:16px;
  background: rgba(0,0,0,0.7);
  box-shadow:0 0 40px rgba(255,0,0,0.4);
}

.back{
  display:inline-block;
  color:#00ff00;
  text-decoration:none;
  margin-bottom:14px;
  opacity:.85;
}
.back:hover{ opacity:1; text-decoration:underline; }

#now-playing{
  margin: 0 0 10px 0;
  color:#00ff00;
  opacity:.9;
  font-size:14px;
}

img{
  width:100%;
  max-width:360px;
  border-radius:12px;
  margin:18px 0 24px;
  box-shadow:0 0 20px rgba(255,0,0,0.3);
  cursor:pointer;
  transition: transform 0.3s, box-shadow 0.3s;
}
img:hover{
  transform:scale(1.03);
  box-shadow:0 0 25px #ff4444,0 0 50px #ff1111;
}

/* Controls */
.controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:20px;
  margin-bottom:12px;
}
button{
  border:none;
  border-radius:50%;
  width:50px;
  height:50px;
  font-size:18px;
  font-weight:bold;
  background:#00ff00;
  color:#111;
  cursor:pointer;
  box-shadow:0 0 8px #00ff00,0 0 16px #00ff00;
  transition:0.3s;
}
button:hover{
  transform: scale(1.12);
  box-shadow:0 0 20px #00ff00,0 0 40px #ff0000;
}

/* Small action buttons row */
.actions{
  display:flex;
  justify-content:center;
  gap:10px;
  flex-wrap:wrap;
  margin: 6px 0 2px;
}
.action-btn{
  display:inline-block;
  padding: 10px 12px;
  border-radius: 14px;
  width:auto;
  height:auto;
  font-size:13px;
  background:#000;
  color:#00ff00;
  border:2px solid #00ff00;
  box-shadow:none;
}
.action-btn:hover{
  background:#00ff00;
  color:#000;
  transform:none;
  box-shadow:none;
}
.action-btn.on{
  background:#00ff00;
  color:#000;
}

/* Status line */
#status-line{
  min-height:18px;
  font-size:13px;
  color:#00ff00;
  opacity:.9;
  margin: 6px 0 10px;
}

/* Progress */
.progress-wrapper{
  display:flex;
  align-items:center;
  justify-content:space-between;
  width:80%;
  margin:auto;
}
.progress-container{
  flex:1;
  height:8px;
  background: rgba(0,255,0,0.3);
  border-radius:4px;
  margin:0 10px;
  cursor:pointer;
  overflow:hidden;
}
.progress-bar{
  width:0%;
  height:100%;
  border-radius:4px;
  background: linear-gradient(270deg,#00ff00,#00cc00,#00ff00);
  background-size:600% 100%;
  animation: flow 4s linear infinite;
  transition: width 0.1s linear;
}
@keyframes flow{ 0%{background-position:0%} 100%{background-position:600%} }

#current-time,#total-time{
  font-size:14px;
  color:#00ff00;
  min-width:45px;
}

/* Volume */
.volume-wrapper{
  margin-top:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
}
.volume-icon{
  font-size:18px;
  color:#00ff00;
  text-shadow:0 0 6px #00ff00;
  cursor:pointer;
}
#volume-slider{ width:120px; height:4px; cursor:pointer; }

/* Playlist */
.playlist{
  margin-top:25px;
  text-align:left;
}
.track{
  padding:10px 14px;
  border-radius:8px;
  background: rgba(0,255,0,0.05);
  margin:8px 0;
  transition: background 0.3s, transform 0.2s;
  cursor:pointer;
}
.track:hover{
  background: rgba(0,255,0,0.15);
  transform:scale(1.02);
}
.track.current{
  background: rgba(0,255,0,0.25);
  box-shadow:0 0 20px #00ff00,0 0 40px #00ff00;
}

/* Cover Animation */
@keyframes coverChange{
  0%{ transform: scale(1); }
  30%{ transform: scale(1.05); }
  60%{ transform: scale(0.98); }
  100%{ transform: scale(1); }
}
.cover-animate{ animation: coverChange 0.5s ease; }
</style>
</head>

<body>
<div class="card">

  <a href="index.html" class="back">‚Üê Tornar</a>

  <h1>Cosmic Marciana</h1>

  <div id="now-playing">Ara sona: <span id="track-name">‚Äî</span></div>

  <img id="cover" src="cover1.png" alt="Portada" onclick="togglePlay()">

  <div class="controls">
    <button onclick="prevTrack()" aria-label="Anterior">‚èÆ</button>
    <button id="play-pause" onclick="togglePlay()" aria-label="Play/Pause">‚ñ∂</button>
    <button onclick="stopTrack()" aria-label="Stop">‚èπ</button>
    <button onclick="nextTrack()" aria-label="Seg√ºent">‚è≠</button>
  </div>

  <div class="actions">
    <button id="shuffle-btn" class="action-btn" onclick="toggleShuffle()" aria-label="Shuffle">üîÄ Shuffle</button>
    <button id="loop-btn" class="action-btn" onclick="cycleLoop()" aria-label="Loop">üîÅ Loop: OFF</button>
    <button class="action-btn" onclick="sharePage()" aria-label="Compartir">üîó Compartir</button>
  </div>

  <div id="status-line"></div>

  <div class="progress-wrapper">
    <span id="current-time">0:00</span>
    <div class="progress-container" onclick="seek(event)">
      <div class="progress-bar" id="progress-bar"></div>
    </div>
    <span id="total-time">0:00</span>
  </div>

  <div class="volume-wrapper">
    <span class="volume-icon" id="volume-icon">üîä</span>
    <input type="range" id="volume-slider" min="0" max="100" value="100">
  </div>

  <div class="playlist">
    <div class="track" data-index="0">Los pobres m√©s</div>
    <div class="track" data-index="1">Volveremos a empezar</div>
    <div class="track" data-index="2">Qui√©n llena los shows</div>
    <div class="track" data-index="3">Can√ß√≥ 4</div>
    <div class="track" data-index="4">Can√ß√≥ 5</div>
    <div class="track" data-index="5">Can√ß√≥ 6</div>
    <div class="track" data-index="6">Can√ß√≥ 7</div>
    <div class="track" data-index="7">Can√ß√≥ 8</div>
    <div class="track" data-index="8">Can√ß√≥ 9</div>
    <div class="track" data-index="9">Can√ß√≥ 10</div>
    <div class="track" data-index="10">Can√ß√≥ 11</div>
  </div>

  <audio id="audio" preload="metadata"></audio>

</div>

<script>
const tracks = Array.from(document.querySelectorAll(".track"));
const audio = document.getElementById("audio");
const progressBar = document.getElementById("progress-bar");
const playPauseBtn = document.getElementById("play-pause");
const coverImg = document.getElementById("cover");

const currentTimeEl = document.getElementById("current-time");
const totalTimeEl = document.getElementById("total-time");

const volumeSlider = document.getElementById("volume-slider");
const volumeIcon = document.getElementById("volume-icon");

const trackNameEl = document.getElementById("track-name");
const statusLineEl = document.getElementById("status-line");
const shuffleBtn = document.getElementById("shuffle-btn");
const loopBtn = document.getElementById("loop-btn");

let currentIndex = 0;
let lastVolume = 1;

// Loop modes: 0=OFF, 1=SONG, 2=ALBUM
let loopMode = 0;
let shuffleOn = false;

/* Files */
const sources = [
  "lospobres.mp3","vae.mp3","shows.mp3","canco4.mp3","canco5.mp3",
  "canco6.mp3","canco7.mp3","canco8.mp3","canco9.mp3","canco10.mp3","canco11.mp3"
];

const covers = [
  "cover1.png","cover2.jpg","cover3.png","cover4.png","cover5.png",
  "cover6.png","cover7.png","cover8.png","cover9.png","cover10.png","cover11.png"
];

/* TITLES: edita aqu√≠ los nombres reales cuando quieras */
const titles = [
  "Los pobres m√©s",
  "Volveremos a empezar",
  "Qui√©n llena los shows",
  "STOP!",
  "Reza",
  "De pie",
  "Quemarlo todo",
  "Nadie sabe nada",
  "Lo que no quiero",
  "La casa del terror",
  "Tenemos que hablar"
];

function formatTime(t){
  const m = Math.floor(t / 60);
  const s = Math.floor(t % 60);
  return m + ":" + ("0" + s).slice(-2);
}

function setStatus(msg){
  if(!statusLineEl) return;
  statusLineEl.textContent = msg || "";
  if(msg){
    clearTimeout(setStatus._t);
    setStatus._t = setTimeout(()=>{ statusLineEl.textContent = ""; }, 1400);
  }
}

function syncButtons(){
  if(shuffleBtn){
    shuffleBtn.classList.toggle("on", shuffleOn);
    shuffleBtn.textContent = shuffleOn ? "üîÄ Shuffle: ON" : "üîÄ Shuffle";
  }
  if(loopBtn){
    const txt = loopMode === 0 ? "üîÅ Loop: OFF" : (loopMode === 1 ? "üîÇ Loop: CAN√á√ì" : "üîÅ Loop: √ÄLBUM");
    loopBtn.textContent = txt;
    loopBtn.classList.toggle("on", loopMode !== 0);
  }
}

/* Load */
function loadTrack(index){
  audio.src = sources[index];
  coverImg.src = covers[index];

  tracks.forEach(t=>t.classList.remove("current"));
  tracks[index].classList.add("current");

  if(trackNameEl) trackNameEl.textContent = titles[index] || tracks[index]?.textContent || "‚Äî";

  coverImg.classList.remove("cover-animate");
  void coverImg.offsetWidth;
  coverImg.classList.add("cover-animate");
}

/* Play */
function playTrack(index){
  currentIndex = index;
  loadTrack(index);

  audio.play().then(()=>{
    playPauseBtn.textContent="‚è∏";
  }).catch(()=>{
    playPauseBtn.textContent="‚ñ∂";
  });
}

function togglePlay(){
  if(!audio.src) loadTrack(currentIndex);

  if(audio.paused){
    audio.play().then(()=> playPauseBtn.textContent="‚è∏").catch(()=>{});
  } else {
    audio.pause();
    playPauseBtn.textContent="‚ñ∂";
  }
}

function stopTrack(){
  audio.pause();
  audio.currentTime = 0;
  playPauseBtn.textContent="‚ñ∂";
}

function getRandomNextIndex(){
  if(tracks.length <= 1) return currentIndex;
  let n = currentIndex;
  while(n === currentIndex){
    n = Math.floor(Math.random() * tracks.length);
  }
  return n;
}

function nextTrack(){
  if(shuffleOn){
    playTrack(getRandomNextIndex());
    return;
  }
  const next = (currentIndex + 1) % tracks.length;
  playTrack(next);
}

function prevTrack(){
  if(shuffleOn){
    playTrack(getRandomNextIndex());
    return;
  }
  const prev = (currentIndex - 1 + tracks.length) % tracks.length;
  playTrack(prev);
}

/* Playlist click */
tracks.forEach(track=>{
  track.addEventListener("click", ()=>{
    playTrack(parseInt(track.dataset.index, 10));
  });
});

/* Progress + remember */
audio.addEventListener("timeupdate", ()=>{
  if(!audio.duration) return;

  currentTimeEl.textContent = formatTime(audio.currentTime);
  totalTimeEl.textContent = formatTime(audio.duration);
  progressBar.style.width = (audio.currentTime/audio.duration*100) + "%";

  try{
    localStorage.setItem("cm_index", String(currentIndex));
    localStorage.setItem("cm_time", String(audio.currentTime));
  } catch {}
});

/* Seek */
function seek(event){
  if(!audio.duration) return;
  const rect = event.currentTarget.getBoundingClientRect();
  const pct = (event.clientX - rect.left) / rect.width;
  audio.currentTime = pct * audio.duration;
}

/* Auto end behavior (Loop modes + shuffle) */
audio.addEventListener("ended", ()=>{
  if(loopMode === 1){
    // loop song
    playTrack(currentIndex);
    return;
  }

  if(loopMode === 2){
    // loop album
    nextTrack();
    return;
  }

  // loop off: stop at end of last track, otherwise advance
  if(shuffleOn){
    nextTrack();
    return;
  }

  if(currentIndex === tracks.length - 1){
    stopTrack();
    setStatus("Final del disc.");
  } else {
    nextTrack();
  }
});

/* Volume */
volumeSlider.addEventListener("input", ()=>{
  audio.volume = volumeSlider.value / 100;
  lastVolume = audio.volume;
  updateVolumeIcon();
});

function updateVolumeIcon(){
  if(audio.volume === 0) volumeIcon.textContent = "üîá";
  else if(audio.volume < 0.5) volumeIcon.textContent = "üîâ";
  else volumeIcon.textContent = "üîä";
}

volumeIcon.addEventListener("click", ()=>{
  if(audio.volume > 0){
    lastVolume = audio.volume;
    audio.volume = 0;
    volumeSlider.value = 0;
  } else {
    audio.volume = lastVolume || 1;
    volumeSlider.value = audio.volume * 100;
  }
  updateVolumeIcon();
});

/* Shuffle + Loop controls */
function toggleShuffle(){
  shuffleOn = !shuffleOn;
  try{ localStorage.setItem("cm_shuffle", shuffleOn ? "1" : "0"); } catch {}
  syncButtons();
  setStatus(shuffleOn ? "Shuffle ON üîÄ" : "Shuffle OFF");
}

function cycleLoop(){
  loopMode = (loopMode + 1) % 3;
  try{ localStorage.setItem("cm_loop", String(loopMode)); } catch {}
  syncButtons();
  setStatus(loopMode === 0 ? "Loop OFF" : (loopMode === 1 ? "Loop CAN√á√ì üîÇ" : "Loop √ÄLBUM üîÅ"));
}

/* Share (no alerts) */
async function sharePage(){
  const url = window.location.href;
  try{
    if(navigator.share){
      await navigator.share({ title: "Cosmic Marciana", url });
      setStatus("Compartit üíö");
    } else if(navigator.clipboard){
      await navigator.clipboard.writeText(url);
      setStatus("Link copiat üíö");
    } else {
      setStatus("No es pot copiar aqu√≠");
    }
  } catch {}
}

/* Keyboard */
document.addEventListener("keydown", (e)=>{
  if(e.code === "Space"){
    e.preventDefault();
    togglePlay();
  }
  if(e.code === "ArrowRight") nextTrack();
  if(e.code === "ArrowLeft") prevTrack();
});

/* INIT: restore track + time + shuffle + loop */
(function init(){
  // restore toggles
  try{
    shuffleOn = (localStorage.getItem("cm_shuffle") === "1");
    const lm = parseInt(localStorage.getItem("cm_loop") || "0", 10);
    loopMode = Number.isFinite(lm) ? Math.min(Math.max(lm,0),2) : 0;
  } catch {}

  // restore position
  try{
    const savedIndex = parseInt(localStorage.getItem("cm_index") || "0", 10);
    const savedTime = parseFloat(localStorage.getItem("cm_time") || "0");

    currentIndex = Number.isFinite(savedIndex)
      ? Math.min(Math.max(savedIndex, 0), tracks.length - 1)
      : 0;

    loadTrack(currentIndex);

    audio.addEventListener("loadedmetadata", ()=>{
      if(Number.isFinite(savedTime) && savedTime > 0 && savedTime < audio.duration){
        audio.currentTime = savedTime;
      }
    }, { once:true });
  } catch {
    loadTrack(0);
  }

  audio.volume = 1;
  updateVolumeIcon();
  syncButtons();
})();
</script>

</body>
</html>


